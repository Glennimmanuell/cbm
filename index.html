<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Bosch Rexroth Industrial Dashboard</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="history.css">
</head>
<body>
    <!-- Navigation Header -->
    <div id="mainHeader" class="main-header">
        <div class="logo">
            <img src="bosch-rexroth.jpg" 
                 style="height:40px; vertical-align:middle; margin-right:8px;">
            Bosch Rexroth Industrial Suite
        </div>
        <div class="header-nav">
            <button class="nav-btn active" onclick="showArchitecture()">Architecture Designer</button>
            <button class="nav-btn" onclick="showMonitoring()">Condition Monitoring</button>
            <button class="nav-btn" onclick="showNotifications()">Alarms</button>
            <button class="nav-btn" onclick="showHistory()">Historical Data</button>
            <button class="nav-btn" onclick="exportAllConfiguration()">Export</button>
            <input type="file" id="importFile" style="display:none" onchange="importAllConfiguration(this.files[0])" />
            <button class="nav-btn"onclick="document.getElementById('importFile').click()">Import</button>
        </div>
    </div>

    <!-- Architecture Designer Section -->
    <div id="architectureSection" class="main-section active">
        <div id="header" class="section-header">
            <div class="section-title">
                Bosch Rexroth Structure
            </div>
            <div class="header-controls">
                <button class="btn" onclick="clearCanvas()">Clear All</button>
                <button class="btn" onclick="toggleGrid()">Toggle Grid</button>
            </div>
        </div>

        <div id="sidebar">
            <div class="component-category">
                <div class="category-title">Field Level</div>
                <div class="component-item" draggable="true" data-type="Sensor" data-icon="sensor.png">
                    <div class="component-icon"><img src="sensor.png" alt="Sensor" style="width: 32px; height: 32px;"></div>
                    <div class="component-name">Sensor</div>
                </div>
                <div class="component-item" draggable="true" data-type="Electric Motor" data-icon="electric-motor.png">
                    <div class="component-icon"><img src="electric-motor.png" alt="Electric Motor" style="width: 32px; height: 32px;"></div>
                    <div class="component-name">Electric Motor</div>
                </div>
                <div class="component-item" draggable="true" data-type="Hydraulic Motor" data-icon="ctrlx-hidrolik-motor.jpg">
                    <div class="component-icon"><img src="ctrlx-hidrolik-motor.jpg" alt="Hydraulic Motor" style="width: 32px; height: 32px;"></div>
                    <div class="component-name">Hydraulic Motor</div>
                </div>
                <div class="component-item" draggable="true" data-type="Hydraulic Pump" data-icon="ctrlx-hidrolik-pump.jpg">
                    <div class="component-icon"><img src="ctrlx-hidrolik-pump.jpg" alt="Hydraulic Pump" style="width: 32px; height: 32px;"></div>
                    <div class="component-name">Hydraulic Pump</div>
                </div>
                <div class="component-item" draggable="true" data-type="Hydraulic Cylinder" data-icon="ctrlx-hidrolik-silinder.jpg">
                    <div class="component-icon"><img src="ctrlx-hidrolik-silinder.jpg" alt="Hydraulic Cylinder" style="width: 32px; height: 32px;"></div>
                    <div class="component-name">Hydraulic Cylinder</div>
                </div>
                <div class="component-item" draggable="true" data-type="VFD" data-icon="ctrlx-efc.png">
                    <div class="component-icon"><img src="ctrlx-efc.png" alt="VFD" style="width: 32px; height: 32px;"></div>
                    <div class="component-name">VFD</div>
                </div>
                <div class="component-item" draggable="true" data-type="CtrlX IO" data-icon="ctrlx-io.png">
                    <div class="component-icon"><img src="ctrlx-io.png" alt="CtrlX IO" style="width: 32px; height: 32px;"></div>
                    <div class="component-name">CtrlX IO</div>
                </div>
            </div>
            
            <div class="component-category">
                <div class="category-title">Control Level</div>
                <div class="component-item" draggable="true" data-type="CtrlX Core" data-icon="ctrlx-core.png">
                    <div class="component-icon"><img src="ctrlx-core.png" alt="CtrlX Core" style="width: 32px; height: 32px;"></div>
                    <div class="component-name">CtrlX Core</div>
                </div>
                <div class="component-item" draggable="true" data-type="HMI" data-icon="ctrlx-hmi.png">
                    <div class="component-icon"><img src="ctrlx-hmi.png" alt="HMI" style="width: 32px; height: 32px;"></div>
                    <div class="component-name">HMI</div>
                </div>
            </div>
            
            <div class="component-category">
                <div class="category-title">Network & Communication</div>
                <div class="component-item" draggable="true" data-type="Industrial Router" data-icon="industrial-router.png">
                    <div class="component-icon"><img src="industrial-router.png" alt="Industrial Router" style="width: 32px; height: 32px;"></div>
                    <div class="component-name">Industrial Router</div>
                </div>
                <div class="component-item" draggable="true" data-type="Network Switch" data-icon="network-switch.png">
                    <div class="component-icon"><img src="network-switch.png" alt="Network Switch" style="width: 32px; height: 32px;"></div>
                    <div class="component-name">Network Switch</div>
                </div>
            </div>
            
            <div class="component-category">
                <div class="category-title">Enterprise Level</div>
                <div class="component-item" draggable="true" data-type="Cloud" data-icon="‚òÅÔ∏è">
                    <div class="component-icon">‚òÅÔ∏è</div>
                    <div class="component-name">Cloud</div>
                </div>
            </div>
        </div>

        <div id="canvas-container">
            <div class="grid-overlay" id="grid"></div>
            <canvas id="canvas"></canvas>
            <svg id="connections" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none;">
            </svg>
        </div>

        <div class="properties-panel" id="propertiesPanel">
            <h3>Component Properties</h3>
            <div class="property-group">
                <label>Name</label>
                <input type="text" id="componentName" placeholder="Component name">
            </div>
            <div class="property-group">
                <label>Description</label>
                <input type="text" id="componentDesc" placeholder="Description">
            </div>
            <div class="property-group">
                <label>IP Address</label>
                <input type="text" id="componentIP" placeholder="192.168.1.1">
            </div>
        </div>
    </div>

    <!-- Condition Monitoring Section -->
    <div id="monitoringSection" class="main-section">
        <div class="header monitoring-header">
            <h1 class="logo">
                Condition Based Monitoring
            </h1>
            <div class="status-bar">
                <div class="system-status">
                    <div class="status-indicator normal">
                        <div class="status-dot" style="background: #4caf50;"></div>
                        <span id="normalCount">0 Normal</span>
                    </div>
                    <div class="status-indicator critical">
                        <div class="status-dot" style="background: #f44336;"></div>
                        <span id="criticalCount">0 Critical</span>
                    </div>
                </div>
                <div class="connection-status">
                    <div class="connection-dot" id="connectionDot"></div>
                    <span id="connectionStatus">Waiting for data...</span>
                    <span style="color: #ccc; margin-left: 10px;">Last Update: <span id="lastUpdate">Never</span></span>
                </div>
            </div>
        </div>

        <!-- Global Settings Button -->
        <div class="global-settings-bar">
            <button class="btn btn-primary" onclick="openGlobalSettings()">Global Threshold Settings</button>
        </div>

        <div class="dashboard-grid" id="dashboardGrid">
            <!-- Cards will be dynamically generated based on input data -->
        </div>

        <!-- Output Section -->
        <div class="output-section" id="outputSection" style="display: none;">
            <div class="output-header">
                <h4>‚ö†Ô∏è System Alerts</h4>
                <button class="btn btn-danger btn-sm" onclick="clearAlerts()" style="padding: 4px 8px; font-size: 12px;">Clear</button>
            </div>
            <div class="output-content" id="outputContent">
                <!-- Alert messages will appear here -->
            </div>
        </div>

        <!-- Global Settings Modal -->
        <div id="globalSettingsModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 class="modal-title">Global Threshold Settings</h2>
                    <span class="close" onclick="closeGlobalSettings()">&times;</span>
                </div>
                <div class="modal-body">
                    <div class="global-settings">
                        <div class="settings-section">
                            <h3>Select Motor</h3>
                            <select id="motorSelector"></select>
                        </div>
                        <div class="settings-section">
                            <h3>Threshold Rules</h3>
                            <div class="threshold-rules" id="thresholdRules">
                                <!-- Threshold rules will be rendered here -->
                            </div>
                            <div class="add-rule-section">
                                <h4>Add New Threshold Rule</h4>
                                <div class="rule-form">
                                    <div class="condition-builder">
                                        <select id="newRuleData1">
                                            <option value="">Select Data 1</option>
                                        </select>
                                        <select id="newRuleOperator1">
                                            <option value=">">></option>
                                            <option value="<"><</option>
                                            <option value=">=">>=</option>
                                            <option value="<="><=</option>
                                            <option value="==">==</option>
                                            <option value="!=">!=</option>
                                        </select>
                                        <input type="number" id="newRuleValue1" placeholder="Value" step="0.1">

                                        <!-- üîΩ Tambahan dropdown operator -->
                                        <select id="newRuleLogicalOperator">
                                            <option value="AND">AND</option>
                                            <option value="OR">OR</option>
                                            <option value="EQUAL">EQUAL</option>
                                        </select>

                                        <select id="newRuleData2">
                                            <option value="">Select Data 2</option>
                                        </select>
                                        <select id="newRuleOperator2">
                                            <option value=">">></option>
                                            <option value="<"><</option>
                                            <option value=">=">>=</option>
                                            <option value="<="><=</option>
                                            <option value="==">==</option>
                                            <option value="!=">!=</option>
                                        </select>
                                        <input type="number" id="newRuleValue2" placeholder="Value" step="0.1">
                                    </div>
                                    <div class="rule-output">
                                        <label>Alert Message:</label>
                                        <input type="text" id="newRuleMessage" placeholder="Enter alert message">
                                    </div>
                                    <div class="rule-color">
                                        <label>Status Color:</label>
                                        <select id="newRuleColor">
                                            <option value="green">Green</option>
                                            <option value="yellow">Yellow</option>
                                        </select>
                                    </div>
                                    <button class="btn btn-primary" onclick="addThresholdRule()">Add Rule</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="settings-section">
                            <h3>Critical Threshold Settings</h3>
                            <p style="color: #94a3b8; font-size: 14px; margin-bottom: 15px;">
                                Critical thresholds are automatically determined from your alert message rules above. 
                                When any rule's alert message is triggered, it will be classified as critical.
                            </p>
                            <div class="critical-settings" id="criticalSettings">
                                <!-- Critical settings will be auto-generated from alert rules -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Notifications Section -->
    <div id="notificationsSection" class="main-section">
        <div class="header notifications-header">
            <h1 class="logo">
                System Alarms
            </h1>
            <div class="notifications-controls">
                <button class="btn btn-primary" onclick="clearAllNotifications()">Clear All</button>
                <button class="btn btn-secondary" onclick="openNotificationSettings()">Settings</button>
                <div class="notifications-filter">
                    <select id="notificationFilter" onchange="filterNotifications()">
                        <option value="all">All Alarms</option>
                        <option value="critical">Critical Only</option>
                        <option value="alert">Alerts Only</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="notifications-stats">
            <div class="stat-card critical-stat">
                <div class="stat-icon">üö®</div>
                <div class="stat-info">
                    <div class="stat-value" id="totalCritical">0</div>
                    <div class="stat-label">Critical</div>
                </div>
            </div>
            <div class="stat-card alert-stat">
                <div class="stat-icon">‚ö†Ô∏è</div>
                <div class="stat-info">
                    <div class="stat-value" id="totalAlerts">0</div>
                    <div class="stat-label">Alerts</div>
                </div>
            </div>
            <div class="stat-card resolved-stat">
                <div class="stat-icon">‚úÖ</div>
                <div class="stat-info">
                    <div class="stat-value" id="totalResolved">0</div>
                    <div class="stat-label">Resolved</div>
                </div>
            </div>
        </div>

        <div class="notifications-container" id="notificationsContainer">
            <div class="no-notifications" id="noNotifications">
                <div class="no-notifications-icon">üîî</div>
                <div class="no-notifications-text">No Alarms available</div>
            </div>
        </div>

        <!-- Notification Settings Modal -->
        <div id="notificationSettingsModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 class="modal-title">Alarm Settings</h2>
                    <span class="close" onclick="closeNotificationSettings()">&times;</span>
                </div>
                <div class="modal-body">
                    <div class="notification-settings">
                        <div class="settings-section">
                            <h3>Critical Threshold Management</h3>
                            <div class="critical-thresholds-list" id="criticalThresholdsList">
                                <!-- Critical thresholds from condition monitoring will be displayed here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Historical Data Section -->
    <div id="historySection" class="main-section">
        <div class="header history-header">
            <h1 class="logo">Historical Data</h1>
            <div class="history-controls">
                <input type="text" id="historySearch" placeholder="Search..." onkeyup="filterHistoryTable()">
                <button class="btn btn-secondary" onclick="clearHistoryTable()">Clear</button>
                <select id="historySort" onchange="sortHistoryByOption()">
                    <option value="">Select Sort Option</option>
                    <option value="date_asc">Date (Oldest First)</option>
                    <option value="date_desc">Date (Newest First)</option>
                    <option value="value_asc">Value (Lowest First)</option>
                    <option value="value_desc">Value (Highest First)</option>
                </select>
                <button class="btn btn-primary" onclick="exportHistoryToCSV()">Export CSV</button>
                <input type="file" id="importHistoryFile" style="display:none" accept=".csv" onchange="importHistoryFromCSV(this.files[0])" />
                <button class="btn btn-secondary" onclick="document.getElementById('importHistoryFile').click()">Import CSV</button>
            </div>
        </div>
        <div class="history-table-container">
            <table id="historyTable">
                <thead>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>
    
    <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
    <script src="script.js"></script>
    <script src="history.js"></script>
</body>
</html>